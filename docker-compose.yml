version: '3.7'
services:
  dependency-track:
    image: dependencytrack/apiserver
    ports:
      - "8080:8080"
    environment:
      - ALPINE_BUILDER=enabled
      - EXTENSION_BOM_ENABLED=true
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/"]
      interval: 60s
      timeout: 10s
      retries: 10

  sbom-uploader:
    build: .
    environment:
      - NODE_REPO_URL=https://github.com/duncanlester/testcafe-api.git
      - DEPENDENCY_TRACK_API_KEY=your-dependency-track-api-key
    depends_on:
      - dependency-track
    volumes:
      - ./config.yaml:/app/config.yaml
      - ./templates:/app/templates
      # Optionally, share report output with host
      - ./output:/app/output
    working_dir: /app